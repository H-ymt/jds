# 十二大従星の計算方法に関する流派の違い

## 概要

算命学の十二大従星（じゅうにだいじゅせい）の計算において、参照している3つのスクリーンショット/PDFで**2つの異なる流派**が使用されていることが判明しました。

## スクリーンショットの分類

| ファイル          | UI                            | 流派  |
| ----------------- | ----------------------------- | ----- |
| 19940120woman.png | ダークテーマ（黒背景）        | 流派A |
| 19970226woman.png | ダークテーマ（黒背景）        | 流派A |
| 19980720man.png   | ライトテーマ（白/ピンク背景） | 流派B |

**重要**: 1994と1997は**同じサイト**（ダークテーマ）からのスクリーンショットで、同じ流派Aを使用しています。

## 検証した3つの生年月日

| 項目 | 1994年1月20日 | 1997年2月26日 | 1998年7月20日 |
| ---- | ------------- | ------------- | ------------- |
| 年柱 | 癸酉          | 丁丑          | 戊寅          |
| 月柱 | 甲寅          | 壬寅          | 己未          |
| 日柱 | 丙午          | 己亥          | 戊辰          |
| 日干 | 丙            | 己            | 戊            |
| 年支 | 酉            | 丑            | 寅            |
| 日支 | 午            | 亥            | 辰            |

### スクリーンショットでの正解値

**1994年1月20日（ダークサイト）:**

- 左肩（幼少期）: 天極星
- 右足（晩年期）: 天将星
- 左足（中年期）: 天印星

**1997年2月26日（ダークサイト）:**

- 左肩（幼少期）: 天庫星
- 右足（晩年期）: 天報星
- 左足（中年期）: 天極星

**1998年7月20日（ライトサイト）:**

- 左肩（幼少期）: 天貴星
- 右足（晩年期）: 天南星
- 左足（中年期）: 天堂星

## 逆算による計算方法の特定

### 十二大従星表（日干と十二支の対応）

十二大従星は「日干 × 十二支」で決まります。逆算して、どの十二支が使われているかを特定しました。

**1994年1月20日（日干=丙、流派A）:**
| 従星 | 正解 | 該当する支 | 支の由来 |
|------|------|-----------|---------|
| 左肩 | 天極星 | 丙×酉 | **年支** |
| 右足 | 天将星 | 丙×午 | 日支の三合帝旺位（午→午） |
| 左足 | 天印星 | 丙×丑 | **年支の三合墓位**（酉→丑） |

**1997年2月26日（日干=己、流派A）:**
| 従星 | 正解 | 該当する支 | 支の由来 |
|------|------|-----------|---------|
| 左肩 | 天庫星 | 己×丑 | **年支** |
| 右足 | 天報星 | 己×卯 | 日支の三合帝旺位（亥→卯） |
| 左足 | 天極星 | 己×子 | **年支の支合相手**（丑→子）※例外処理 |

> ⚠️ 1997年の左足は「年支の三合墓位」ではなく「年支の支合相手」を使用。
> これは年支（丑）が三合墓位そのものであるため、例外処理が適用されたもの。

**1998年7月20日（日干=戊、流派B）:**
| 従星 | 正解 | 該当する支 | 支の由来 |
|------|------|-----------|---------|
| 左肩 | 天貴星 | 戊×辰 | **日支** |
| 右足 | 天南星 | 戊×午 | 年支の三合帝旺位（寅→午） |
| 左足 | 天堂星 | 戊×酉 | 日支の支合相手（辰→酉） |

## 2つの流派の計算ルール

### 流派A（ダークサイト: 1994, 1997）

```
左肩（幼少期）= 日干 × 年支
右足（晩年期）= 日干 × 日支の三合帝旺位
左足（中年期）= 日干 × 年支の三合墓位
                ↓
                年支が墓位そのもの（丑/辰/未/戌）の場合は
                → 年支の支合相手を使う
```

### 流派B（ライトサイト: 1998）← **現在採用中**

```
左肩（幼少期）= 日干 × 日支
右足（晩年期）= 日干 × 年支の三合帝旺位
左足（中年期）= 日干 × 日支の支合相手
```

### 主な違い

| 位置           | 流派A（ダークサイト）      | 流派B（ライトサイト） |
| -------------- | -------------------------- | --------------------- |
| 左肩（幼少期） | 年支                       | 日支                  |
| 右足（晩年期） | 日支の三合帝旺位           | 年支の三合帝旺位      |
| 左足（中年期） | 年支の三合墓位（例外あり） | 日支の支合相手        |

## 参照データ

### 支合（六合）の対応表

```
子 ↔ 丑
寅 ↔ 亥
卯 ↔ 戌
辰 ↔ 酉
巳 ↔ 申
午 ↔ 未
```

### 三合帝旺位の対応表

| 三合局 | 構成       | 帝旺位 |
| ------ | ---------- | ------ |
| 火局   | 寅・午・戌 | 午     |
| 金局   | 巳・酉・丑 | 酉     |
| 水局   | 申・子・辰 | 子     |
| 木局   | 亥・卯・未 | 卯     |

### 三合墓位の対応表

| 三合局 | 構成       | 墓位 |
| ------ | ---------- | ---- |
| 火局   | 寅・午・戌 | 戌   |
| 金局   | 巳・酉・丑 | 丑   |
| 水局   | 申・子・辰 | 辰   |
| 木局   | 亥・卯・未 | 未   |

> 墓位（丑/辰/未/戌）が年支の場合、流派Aでは「三合墓位」ではなく「支合相手」を使用する例外処理あり

## 現在の実装状況

### 流派Bで統一した場合（現在の実装）

**テスト結果:**

| 生年月日   | 結果     | 備考                    |
| ---------- | -------- | ----------------------- |
| 1994/01/20 | ✗ 不一致 | 流派Aを使用しているため |
| 1997/02/26 | ✗ 不一致 | 流派Aを使用しているため |
| 1998/07/20 | ✓ 一致   | 流派Bと一致             |

## 決定事項

- [ ] 流派Aを採用する（ダークサイトの1994/1997と一致）
- [x] 流派Bを採用する（ライトサイトの1998と一致）← **現在採用中**
- [ ] 設定で切り替え可能にする

## 対応方針

### 推奨: 流派Bを維持

**理由:**

1. 1998年のPDF（半代大和様.pdf）がユーザー本人の鑑定結果である可能性が高い
2. ダークサイトのスクリーンショットは参考として取得した別サービスのものと推測される
3. 流派Bの方がシンプルな計算ロジック（例外処理が不要）

**今後の対応:**

1. 現在の流派B実装を維持
2. ユーザーから流派Aへの変更要望があれば対応
3. 必要に応じて設定画面で流派を切り替え可能にする

### 代替案: 流派Aへ変更

流派Aへ変更する場合は、以下の実装が必要：

1. 三合墓位のマッピングテーブル追加
2. 左足の計算で「年支が墓位の場合は支合を使う」例外処理の実装
3. 右足の計算を「日支の三合帝旺位」に変更

## 備考

- 十大主星の計算は全てのスクリーンショット/PDFで一致しています
- 人体星図の配置位置（頭・胸・腹・左手・右手・右肩）も一致しています
- 相違があるのは十二大従星（左肩・右足・左足）の計算方法のみです
