# 算命学 Web アプリケーション 要件定義書

## 1. プロジェクト概要

### 1.1 目的

算命学の複雑な計算ロジック（陰占・陽占・干合変化）を自動化し、初心者にもわかりやすい解説付きのモダンな UI で提供する Web アプリケーション。

### 1.2 ターゲットユーザー

- 算命学に興味がある一般ユーザー
- 占いや自己分析に関心のある 20〜40 代
- 算命学の基礎を学びたい初心者

### 1.3 技術スタック

| 項目           | 技術                                         |
| -------------- | -------------------------------------------- |
| Frontend       | Next.js+ (App Router) / React                |
| Styling        | Tailwind CSS                                 |
| State 管理     | React Hooks (useState, useMemo)              |
| Deployment     | Vercel                                       |
| アニメーション | CSS Transitions + Motion（旧:Framer Motion） |

---

## 2. 機能要件

### 2.1 入力機能

#### 2.1.1 生年月日入力

- **入力方式**: HTML5 DatePicker
- **バリデーション**: 未入力時は鑑定ボタン無効化
- **対応範囲**: 1900 年〜現在

#### 2.1.2 性別選択

- **選択肢**: 女性 / 男性
- **デフォルト**: 女性
- **UI**: トグルボタン形式

#### 2.1.3 鑑定実行

- **ローディング演出**: 1.5 秒のスピナーアニメーション
- **状態遷移**: 入力画面 → 結果画面

---

### 2.2 算出エンジン（コアロジック）

#### 2.2.1 陰占算出

生年月日から年柱・月柱・日柱の干支を算出。

```
入力: Date (生年月日)
出力: {
  year: { kan: 天干, shi: 地支 },
  month: { kan: 天干, shi: 地支 },
  day: { kan: 天干, shi: 地支 }
}
```

**計算ルール**:

- 年柱: 立春（2 月 4 日頃）を年の区切りとする
- 月柱: 各月の節入り日で切り替え
- 日柱: 基準日からの日数で算出

#### 2.2.2 蔵干（ぞうかん）算出

各地支から本元の天干を取得。

| 地支 | 本元 |
| ---- | ---- |
| 子   | 癸   |
| 丑   | 己   |
| 寅   | 甲   |
| 卯   | 乙   |
| 辰   | 戊   |
| 巳   | 丙   |
| 午   | 丁   |
| 未   | 己   |
| 申   | 庚   |
| 酉   | 辛   |
| 戌   | 戊   |
| 亥   | 壬   |

#### 2.2.3 陽占（人体星図）算出

**十大主星**: 日干と各蔵干の関係から算出

| 位置       | 算出方法        |
| ---------- | --------------- |
| 頭（北）   | 日干 × 月支蔵干 |
| 胸（中央） | 日干 × 日干     |
| 腹（南）   | 日干 × 日支蔵干 |
| 左肩（東） | 日干 × 年支蔵干 |
| 右肩（西） | 日干 × 月干     |

**十二大従星**: 日干と各地支の関係から算出

| 位置 | 算出方法    |
| ---- | ----------- |
| 右手 | 日干 × 年支 |
| 左手 | 日干 × 月支 |
| 左足 | 日干 × 日支 |

#### 2.2.4 干合変化（化気法）

**検知対象ペア**:
| ペア | 変化後の五行 |
|------|-------------|
| 甲 - 己 | 土 |
| 乙 - 庚 | 金 |
| 丙 - 辛 | 水 |
| 丁 - 壬 | 木 |
| 戊 - 癸 | 火 |

**処理フロー**:

1. 年干・月干・日干に干合ペアが存在するか判定
2. 存在する場合、変化トグルを表示
3. トグル ON 時、日干を変化後の五行に対応する干に置換
4. 置換後の日干で人体星図を再計算

---

### 2.3 表示機能

#### 2.3.1 タブ構成

| タブ | 内容                         |
| ---- | ---------------------------- |
| 星図 | 陰占・干合・人体星図の表示   |
| 性格 | 傾向分析・エネルギーバランス |
| 詳細 | 全星の解説一覧               |

#### 2.3.2 日干解説表示

各日干に対応する解説データ:

| 日干 | 名称 | 自然物 | 性格特徴               |
| ---- | ---- | ------ | ---------------------- |
| 甲   | 甲木 | 大木   | 向上心・リーダーシップ |
| 乙   | 乙木 | 草花   | 柔軟性・協調性         |
| 丙   | 丙火 | 太陽   | 情熱的・行動力         |
| 丁   | 丁火 | 灯火   | 繊細・知性             |
| 戊   | 戊土 | 山岳   | 信頼感・包容力         |
| 己   | 己土 | 田畑   | 面倒見・粘り強さ       |
| 庚   | 庚金 | 鉄鋼   | 決断力・正直           |
| 辛   | 辛金 | 宝石   | 美意識・プライド       |
| 壬   | 壬水 | 大海   | 自由・スケール         |
| 癸   | 癸水 | 雨露   | 洞察力・忍耐           |

#### 2.3.3 十大主星解説

各星に対応するデータ構造:

```typescript
{
  keyword: string,    // 例: "独立・自我"
  element: string,    // 五行（木/火/土/金/水）
  desc: string        // 100〜150字の解説文
}
```

#### 2.3.4 十二大従星解説

各星に対応するデータ構造:

```typescript
{
  energy: number,     // 1〜12のエネルギー値
  phase: string,      // 人生段階（胎児〜転生）
  desc: string        // 特徴の解説文
}
```

#### 2.3.5 五行カラーマッピング

| 五行 | 背景色      | 文字色   |
| ---- | ----------- | -------- |
| 木   | emerald-500 | white    |
| 火   | red-500     | white    |
| 土   | yellow-500  | gray-800 |
| 金   | gray-200    | gray-800 |
| 水   | indigo-600  | white    |

#### 2.3.6 星詳細モーダル

- **トリガー**: 星セルをタップ/クリック
- **表示内容**: 星名・キーワード・五行・詳細解説・位置の意味
- **閉じる**: オーバーレイクリック または × ボタン

---

## 3. 非機能要件

### 3.1 パフォーマンス

- 初回ロード: 3 秒以内
- 鑑定計算: 100ms 以内
- タブ切り替え: 即座（リアクティブ）

### 3.2 レスポンシブ対応

- モバイルファースト設計
- 最大幅: 512px (max-w-lg)
- ブレイクポイント: 不要（単一カラム）

### 3.3 アクセシビリティ

- タップターゲット: 44px 以上
- コントラスト比: WCAG AA 準拠
- フォーカス状態の可視化

### 3.4 ブラウザ対応

- Chrome (最新 2 バージョン)
- Safari (最新 2 バージョン)
- Firefox (最新 2 バージョン)
- Edge (最新 2 バージョン)

---

## 4. 画面設計

### 4.1 画面遷移図

```
[入力画面] → [ローディング] → [結果画面]
                                  ├─ 星図タブ
                                  ├─ 性格タブ
                                  └─ 詳細タブ
```

### 4.2 入力画面レイアウト

```
┌─────────────────────────┐
│         🔮              │
│      算命学鑑定          │
│  生年月日から宿命を...    │
├─────────────────────────┤
│  💡 算命学とは？         │
│  [説明テキスト]          │
├─────────────────────────┤
│  生年月日               │
│  [DatePicker]          │
├─────────────────────────┤
│  性別                   │
│  [👩女性] [👨男性]       │
├─────────────────────────┤
│  [  鑑定する ✨  ]       │
└─────────────────────────┘
```

### 4.3 結果画面レイアウト

```
┌─────────────────────────┐
│ ← 新しい鑑定            │
├─────────────────────────┤
│ [星図] [性格] [詳細]     │
├─────────────────────────┤
│ 🌟 あなたの日干          │
│ [日干名称と解説]         │
├─────────────────────────┤
│ 陰占（いんせん）         │
│ [年柱] [月柱] [日柱]     │
├─────────────────────────┤
│ ✨ 干合検出（条件時）     │
│ [変化説明] [トグル]      │
├─────────────────────────┤
│ 陽占 人体星図            │
│ ┌───┬───┬───┐          │
│ │右手│ 頭 │左手│          │
│ ├───┼───┼───┤          │
│ │左肩│ 胸 │右肩│          │
│ ├───┼───┼───┤          │
│ │   │ 腹 │左足│          │
│ └───┴───┴───┘          │
├─────────────────────────┤
│ [木][火][土][金][水]     │
└─────────────────────────┘
```

---

## 5. データ定義

### 5.1 定数マスタ

```typescript
// 十干
const JIKKAN = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];

// 十二支
const JUNISHI = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];

// 十大主星
const JUDAI_SHUSEI = ["貫索星", "石門星", "鳳閣星", "調舒星", "禄存星", "司禄星", "車騎星", "牽牛星", "龍高星", "玉堂星"];

// 十二大従星
const JUNIDAI_JUSEI = [
  "天報星",
  "天印星",
  "天貴星",
  "天恍星",
  "天南星",
  "天禄星",
  "天将星",
  "天堂星",
  "天胡星",
  "天極星",
  "天庫星",
  "天馳星",
];
```

### 5.2 状態管理

```typescript
interface AppState {
  birthDate: string; // 'YYYY-MM-DD'
  gender: "male" | "female";
  isTransformed: boolean; // 干合変化適用フラグ
  showResult: boolean; // 結果画面表示フラグ
  isLoading: boolean; // ローディング状態
  selectedStar: StarDetail | null; // モーダル表示用
  activeTab: "chart" | "personality" | "detail";
}
```

---

## 6. 今後の拡張予定

| 優先度 | 機能             | 概要                            |
| ------ | ---------------- | ------------------------------- |
| 高     | 大運・年運       | 10 年周期・1 年周期の運勢グラフ |
| 高     | 六親法           | 配偶者・子供の星の算出          |
| 中     | PDF エクスポート | 鑑定結果の PDF 出力             |
| 中     | 相性診断         | 2 人の命式の相性分析            |
| 低     | ユーザー登録     | 鑑定履歴の保存                  |
| 低     | SNS シェア       | 結果の SNS 共有機能             |

---

## 7. 改訂履歴

| バージョン | 日付       | 変更内容                 |
| ---------- | ---------- | ------------------------ |
| 1.0.0      | 2024/XX/XX | 初版作成（プロトタイプ） |
